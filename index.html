<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Бобруйск-Кассиопея | Графеновое И-издание</title>
    <!-- Подключаем шрифты -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif:wght@400;700&family=Playfair+Display:wght@400;700&family=Flow+Circular&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #121212;
            --bg-card: rgba(30, 30, 30, 0.8);
            --text-primary: #e0e0e0;
            --text-secondary: #b0b0b0;
            --accent: #7f5af0;
            --accent-light: #9370ff;
            --border: #333;
            --image-filter: brightness(0.8) contrast(1.2);
            --current-font: 'Noto Serif', serif;
        }

        [data-theme="light"] {
            --bg-dark: #f5f5f5;
            --bg-card: rgba(255, 255, 255, 0.8);
            --text-primary: #333333;
            --text-secondary: #666666;
            --accent: #6a5acd;
            --accent-light: #7b68ee;
            --border: #ddd;
            --image-filter: none;
        }
        
        body {
            font-family: var(--current-font);
            line-height: 1.6;
            color: var(--text-primary);
            background-color: var(--bg-dark);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            transition: background-color 0.5s ease, color 0.5s ease;
            text-rendering: optimizeLegibility;
            overflow-x: hidden;
        }
        
        .book-container, .book-frame {
            max-width: 800px;
            margin: 0 auto;
            animation: fadeIn 0.8s ease-out;
            padding: 2rem;
        }
        
        .book-frame {
            background-color: var(--bg-card);
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            transition: all 0.5s ease;
            backdrop-filter: blur(5px);
        }
        
        .title-frame {
            border-top: 1px solid var(--accent);
            border-bottom: 1px solid var(--accent);
            padding: 1.5rem 0;
            margin: 2rem 0;
            text-align: center;
            position: relative;
        }
        
        .title-frame::before, .title-frame::after {
            content: "◆";
            color: var(--accent);
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1rem;
        }
        
        .title-frame::before { left: 1rem; }
        .title-frame::after { right: 1rem; }
        
        h1 {
            color: var(--accent-light);
            font-size: 2.2rem;
            margin: 0;
            font-weight: 700;
            letter-spacing: 0.5px;
            position: relative;
        }
        
        .title-frame h1::before {
            content: "✦✧✦";
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8rem;
            color: rgba(127, 90, 240, 0.3);
            letter-spacing: 3px;
        }
        
        h2 {
            color: var(--accent);
            margin-top: 2.5rem;
            font-size: 1.6rem;
            position: relative;
            padding-bottom: 0.5rem;
            letter-spacing: 0.3px;
        }
        
        h2::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 2px;
            background: linear-gradient(90deg, var(--accent), transparent);
        }
        
        p {
            color: var(--text-primary);
            margin-bottom: 1.2rem;
            font-size: 1.05rem;
            line-height: 1.6;
            hyphens: auto;
            word-break: break-word;
        }
        
        .chapter {
            margin-bottom: 2.5rem;
            transition: transform 0.3s ease;
        }

        .chapter-image-container {
            position: relative;
            width: 100%;
            height: 280px;
            margin: 1.2rem 0;
            overflow: hidden;
            border-radius: 6px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            background: transparent;
            perspective: 1000px;
        }

        .chapter-image-slider {
            display: flex;
            height: 100%;
            transition: transform 1s ease;
        }

        .chapter-image {
            width: 100%;
            height: 100%;
            flex-shrink: 0;
            object-fit: cover;
            filter: var(--image-filter);
            opacity: 0;
            transition: opacity 0.8s ease, transform 0.8s ease;
            transform-style: preserve-3d;
            background: transparent;
            transform-origin: center center;
            will-change: transform;
        }
        
        .chapter-image.loaded {
            opacity: 1;
        }

        .image-nav {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 30%;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.7);
            z-index: 2;
            opacity: 0.7;
        }

        .image-nav:hover {
            opacity: 1;
            background: rgba(0, 0, 0, 0.2);
        }

        .image-nav.prev {
            left: 0;
        }

        .image-nav.next {
            right: 0;
        }

        .image-counter {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            z-index: 2;
            opacity: 0.7;
        }
        
        .chapter:hover { transform: translateX(5px); }
        
        .first-letter {
            font-size: 2.8rem;
            float: left;
            line-height: 0.8;
            margin-right: 0.5rem;
            color: var(--accent-light);
            font-weight: 700;
            margin-top: 0.3rem;
            transition: color 0.3s ease;
        }
        
        .quote {
            font-style: italic;
            color: var(--text-secondary);
            border-left: 3px solid var(--accent);
            padding: 1rem;
            margin: 1.5rem 0;
            background-color: rgba(127, 90, 240, 0.05);
            border-radius: 0 4px 4px 0;
        }
        
        .footer {
            text-align: center;
            margin-top: 3rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
            opacity: 0.7;
        }
        
        hr {
            border: none;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--border), transparent);
            margin: 1.5rem 0;
        }

        .controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 100;
        }

        .control-btn {
            background: var(--accent);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            transform: scale(1.1);
            background: var(--accent-light);
        }

        .font-btn {
            background: rgba(42, 42, 42, 0.8);
            color: var(--accent-light);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            font-size: 18px;
            border: 1px solid var(--border);
            position: fixed;
            left: 20px;
            bottom: 20px;
            z-index: 100;
        }

        .font-btn:hover {
            transform: scale(1.1);
            background: rgba(51, 51, 51, 0.8);
            color: var(--accent-light);
        }

        .font-panel {
            position: fixed;
            bottom: 80px;
            left: 20px;
            background: var(--bg-card);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            display: none;
            flex-direction: column;
            gap: 10px;
            z-index: 99;
            width: 200px;
            backdrop-filter: blur(5px);
        }

        .font-panel.show { display: flex; }
        
        .font-option {
            padding: 8px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 15px;
        }

        .font-option:hover {
            background-color: rgba(127, 90, 240, 0.1);
        }

        .font-option.active {
            background-color: rgba(127, 90, 240, 0.2);
            font-weight: bold;
        }

        .audio-panel {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: var(--bg-card);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            display: none;
            flex-direction: column;
            gap: 10px;
            z-index: 99;
            width: 200px;
            backdrop-filter: blur(5px);
        }

        .audio-panel.show { display: flex; }
        .audio-option, .audio-chapter {
            padding: 8px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .audio-option:hover, .audio-chapter:hover {
            background-color: rgba(127, 90, 240, 0.1);
        }

        .audio-option.active, .audio-chapter.active {
            background-color: rgba(127, 90, 240, 0.2);
            font-weight: bold;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        ::selection {
            background: var(--accent);
            color: white;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border);
            overflow-x: auto;
            scrollbar-width: none;
        }

        .tabs::-webkit-scrollbar { display: none; }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-family: 'Noto Serif', serif;
            font-size: 1rem;
            position: relative;
            transition: all 0.3s ease;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .tab:hover { color: var(--text-primary); }
        .tab.active { color: var(--accent-light); font-weight: bold; }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: var(--accent-light);
        }

        .tab-content { display: none; animation: fadeIn 0.5s ease; }
        .tab-content.active { display: block; }

        .review {
            background-color: rgba(127, 90, 240, 0.05);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 3px solid var(--accent);
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .review-author {
            font-weight: bold;
            color: var(--accent);
        }

        .audio-player {
            width: 100%;
            margin: 20px auto 0;
            background-color: var(--bg-card);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border);
            box-sizing: border-box;
            backdrop-filter: blur(5px);
        }

        .audio-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .audio-btn {
            background-color: var(--accent);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .audio-btn:hover {
            background-color: var(--accent-light);
            transform: scale(1.1);
        }

        .audio-btn.big { width: 50px; height: 50px; }

        .audio-progress-container {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .audio-progress {
            flex-grow: 1;
            height: 5px;
            background-color: var(--border);
            border-radius: 5px;
            position: relative;
            cursor: pointer;
        }
        
        .audio-progress-filled {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background-color: var(--accent);
            border-radius: 5px;
            width: 0%;
        }

        .audio-time {
            font-size: 0.9rem;
            color: var(--text-secondary);
            min-width: 60px;
            text-align: center;
        }

        .story-card {
            background-color: var(--bg-card);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .story-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .story-header {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        .story-title {
            color: var(--accent-light);
            font-size: 1.5rem;
            margin: 0 0 5px 0;
        }

        .story-meta {
            display: flex;
            justify-content: space-between;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .story-full {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease, opacity 0.3s ease;
            opacity: 0;
            margin-top: 15px;
        }

        .story-full.show {
            max-height: 2000px;
            opacity: 1;
        }

        .read-more {
            color: var(--accent);
            text-decoration: none;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            display: inline-block;
        }

        .read-more:hover {
            color: var(--accent-light);
            text-decoration: underline;
        }

        .story-tags {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .story-tag {
            background-color: rgba(127, 90, 240, 0.1);
            color: var(--accent);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            transition: background-color 0.3s ease;
        }

        .story-tag:hover {
            background-color: rgba(127, 90, 240, 0.2);
        }

        /* Стили для анимированного смайла */
        .floating-smiley {
            position: fixed;
            font-size: 2rem;
            z-index: 9999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
            transform-origin: center;
        }

        @keyframes floatAndRotate {
            0% {
                transform: translateX(-100px) translateY(0) rotate(0deg);
            }
            25% {
                transform: translateX(calc(100vw - 100px)) translateY(-50px) rotate(90deg);
            }
            50% {
                transform: translateX(calc(100vw - 100px)) translateY(50px) rotate(180deg);
            }
            75% {
                transform: translateX(-100px) translateY(50px) rotate(270deg);
            }
            100% {
                transform: translateX(-100px) translateY(0) rotate(360deg);
            }
        }

        /* Стили для увеличенного изображения */
        .image-zoom-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .image-zoom-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .zoomed-image {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }

        .zoomed-image.zoom-active {
            transform: scale(1);
        }

        .close-zoom {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            background: none;
            border: none;
            z-index: 1001;
        }

        @media (max-width: 768px) {
            .book-container, .book-frame { padding: 1rem; }
            h1 { font-size: 1.8rem; }
            h2 { font-size: 1.4rem; margin-top: 2rem; }
            p { font-size: 1rem; line-height: 1.5; }
            .controls { bottom: 15px; right: 15px; }
            .font-btn { left: 15px; bottom: 15px; }
            .audio-panel, .font-panel { 
                bottom: 70px; 
                right: 15px; 
                left: 15px;
                width: calc(100% - 30px); 
                max-width: 200px; 
            }
            .tab { padding: 10px 15px; font-size: 0.9rem; }
            .audio-player { 
                width: calc(100% - 2rem); 
                margin-left: auto;
                margin-right: auto;
                padding: 10px; 
            }
            .audio-controls { gap: 8px; }
            .audio-progress { margin: 0 5px; }
            .audio-time { min-width: 50px; font-size: 0.8rem; }
            .story-title { font-size: 1.3rem; }
            .story-meta { flex-direction: column; gap: 5px; }
            .chapter-image-container { height: 200px; }
            
            .title-frame::before, .title-frame::after {
                content: "";
            }
            
            .floating-smiley {
                font-size: 1.5rem;
            }
        }

        @media (max-width: 480px) {
            .book-frame { padding: 0.8rem; }
            .title-frame { padding: 1rem 0; margin: 1.2rem 0; }
            h1 { font-size: 1.6rem; }
            h2 { font-size: 1.3rem; }
            p { font-size: 0.95rem; }
            .first-letter { font-size: 2.2rem; }
            .quote { padding: 0.8rem; margin: 1rem 0; font-size: 0.95rem; }
            .story-card { padding: 15px; }
            .story-title { font-size: 1.2rem; }
            
            .title-frame h1::before {
                font-size: 0.7rem;
                top: -12px;
            }
            
            .audio-player {
                width: calc(100% - 1rem);
                padding: 10px;
            }
            
            .audio-btn {
                width: 36px;
                height: 36px;
            }
            
            .audio-btn.big {
                width: 42px;
                height: 42px;
            }
            
            .floating-smiley {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <!-- Анимированный смайл -->
    <div class="floating-smiley" id="floatingSmiley">༼ﾉຈل͜ຈ༽ﾉ𓍊𓋼</div>

    <!-- Оверлей для увеличенного изображения -->
    <div class="image-zoom-overlay" id="imageZoomOverlay">
        <button class="close-zoom" id="closeZoom">&times;</button>
        <img src="" alt="Увеличенное изображение" class="zoomed-image" id="zoomedImage">
    </div>

    <div class="controls">
        <button class="control-btn" id="themeToggle">☀︎</button>
        <button class="control-btn" id="audioToggle">♫</button>
    </div>

    <!-- Кнопка выбора шрифта теперь слева -->
    <button class="font-btn" id="fontToggle">𝓕</button>

    <div class="audio-panel" id="audioPanel">
        <div class="audio-option" data-sound="Sound/ambient1.ogg">📻 Ambient Radio №1</div>
        <div class="audio-option" data-sound="Sound/ambient2.ogg">📻 Ambient Radio №2</div>
        <div class="audio-option" data-sound="Sound/ambient3.ogg">📻 Ambient Radio №3</div>
        <div class="audio-option" data-sound="none">❌ Выключить</div>
    </div>

    <div class="font-panel" id="fontPanel">
        <div class="font-option active" data-font="'Noto Serif', serif">Noto Serif</div>
        <div class="font-option" data-font="'Flow Circular', cursive">Flow Circular</div>
        <div class="font-option" data-font="'Playfair Display', serif">Playfair Display</div>
    </div>

    <div class="book-container">
        <div class="book-frame">
            <div class="tabs">
                <button class="tab active" data-tab="book">Книга</button>
                <button class="tab" data-tab="audio">Аудиокнига</button>
                <button class="tab" data-tab="reviews">Отзывы</button>
                <button class="tab" data-tab="archive">☰</button>
            </div>

            <div class="tab-content active" id="book-tab">
                <div class="title-frame">
                    <h1>Бобруйск - Кассиопея</h1>
                    <p style="color: var(--text-secondary);">Рассказ от безызвестного автора и создателя бредоказов</p>
                </div>
                
                <div class="chapter">
                    <h2>Глава I: Алхимия пустых карманов&nbsp;</h2>
                    <div class="chapter-image-container">
                        <div class="chapter-image-slider">
                            <img data-src="images/gl1.webp" class="chapter-image" alt="Пролог" loading="lazy">
                            <img data-src="https://source.unsplash.com/random/800x400/?dark,city" class="chapter-image" alt="Дополнительное изображение 1" loading="lazy">
                            <img data-src="https://source.unsplash.com/random/800x400/?night,street" class="chapter-image" alt="Дополнительное изображение 2" loading="lazy">
                        </div>
                        <div class="image-nav prev">‹</div>
                        <div class="image-nav next">›</div>
                        <div class="image-counter">1/3</div>
                    </div>
                    <p><span class="first-letter">Т</span>ьма сгущалась над городом, поглощая последние лучи заката. В этом предисловии я хочу провести вас через те мысли и переживания, которые легли в основу этой истории. Это не просто книга — это путешествие в глубины человеческой души.</p>
                    <p>Каждая глава — новый слой реальности, который мы будем вместе исследовать. Современный ритм повествования сочетается здесь с вечными темами, которые тревожат нас под покровом ночи.</p>
                    <div class="quote">"Иногда пятак в диване - это последний знак что мир ещё не забыл тебя."</div>
                </div>
                
                <div class="chapter">
                    <h2>Глава II: Экзистенциальный слалом</h2>
                    <div class="chapter-image-container">
                        <div class="chapter-image-slider">
                            <img data-src="images/gl2.webp" class="chapter-image" alt="Полночный город" loading="lazy">
                            <img data-src="https://source.unsplash.com/random/800x400/?night,alley" class="chapter-image" alt="Дополнительное изображение 1" loading="lazy">
                            <img data-src="https://source.unsplash.com/random/800x400/?dark,neon" class="chapter-image" alt="Дополнительное изображение 2" loading="lazy">
                        </div>
                        <div class="image-nav prev">‹</div>
                        <div class="image-nav next">›</div>
                        <div class="image-counter">1/3</div>
                    </div>
                  <p><span class="first-letter">Г</span>ород никогда не спит — это ложь. В три часа ночи наступает момент абсолютной тишины, когда даже неоновые огни кажутся приглушёнными. Именно в этот час я впервые увидел Его.</p>
                    <p>Тени на стенах двигались неестественным образом, будто жили собственной жизнью. Воздух был насыщен электричеством предгрозового напряжения, хотя метеорологи не предсказывали осадков.</p>
                  <p>Мои часы показывали 3:07, когда все уличные фонари на набережной погасли одновременно. Не постепенно, не мигая — просто в один момент свет исчез, оставив после себя плотную, почти осязаемую тьму.</p>
                    <div class="quote">"Магазин - это храм, где сканер - единственный бог."</div>
                </div>
                
                <div class="chapter">
                    <h2>Глава III: Люди из CD-Rая</h2>
                    <div class="chapter-image-container">
                        <div class="chapter-image-slider">
                            <img data-src="images/gl3.webp" class="chapter-image" alt="Зов бездны" loading="lazy">
                            <img data-src="https://source.unsplash.com/random/800x400/?abstract,dark" class="chapter-image" alt="Дополнительное изображение 1" loading="lazy">
                            <img data-src="https://source.unsplash.com/random/800x400/?mystery,fog" class="chapter-image" alt="Дополнительное изображение 2" loading="lazy">
                        </div>
                        <div class="image-nav prev">‹</div>
                        <div class="image-nav next">›</div>
                        <div class="image-counter">1/3</div>
                    </div>
                  <p><span class="first-letter">С</span> тех пор как начались видения, сон стал для меня чужим городом, куда я не мог вернуться. Врачи разводили руками, антидепрессанты лишь усиливали яркость образов.</p>
                    <p>Особенно чётко я видел его лицо — точнее, то, что должно было быть лицом. Гладкая, без черт, поверхность, отражающая моё собственное искажённое отражение. Оно приходило ровно в 3:14 ночи и стояло в ногах кровати, пока я не терял сознание от ужаса.</p>
                    <div class="quote">
                    "Человечество делится на тех, кто видел голых людей с дисками, и тех, кто ещё увидит..." </div>
                </div>
                
                <hr>
                
                <div class="footer">
                    <p>© 2025 | Все права защищены</p>
                    <p>Бредоказы 2.0 / Design by EtherKnot</p>
                    <p>Графеновое И-издание ♒︎&nbsp;</p>
                </div>
            </div>

            <div class="tab-content" id="audio-tab">
                <div class="title-frame">
                    <h1>Аудиоверсия книги</h1>
                    <p style="color: var(--text-secondary);">Озвучено профессиональным актёром</p>
                </div>

                <div class="audio-book-container">
                    <p>Погрузитесь в атмосферу "Бобруйск-Кассиопея" с нашей аудиоверсией. Профессиональная озвучка, музыкальное сопровождение и звуковые эффекты создадут полное ощущение присутствия в описываемых событиях.</p>
                    <div class="audio-player">
                        <h3 id="currentChapterTitle">Пролог</h3>
                        <div class="audio-controls">
                            <button class="audio-btn" id="prevChapter">˗ˏˋ</button>
                            <button class="audio-btn big" id="playPause">✈︎ ▌▌</button>
                            <button class="audio-btn" id="nextChapter">ˎˊ˗</button>
                        </div>
                        <div class="audio-progress-container">
                            <span class="audio-time" id="currentTime">0:00</span>
                            <div class="audio-progress" id="audioProgress">
                                <div class="audio-progress-filled" id="progressFilled"></div>
                            </div>
                            <span class="audio-time" id="duration">0:00</span>
                        </div>
                    </div>

                    <div class="audio-chapters">
                        <h3>Главы:</h3>
                        <div class="audio-chapter active" data-audio="audio/prologue.mp3" data-duration="3:45">Пролог (3:45)</div>
                        <div class="audio-chapter" data-audio="audio/chapter1.mp3" data-duration="12:30">Глава 1: Полночный город (12:30)</div>
                        <div class="audio-chapter" data-audio="audio/chapter2.mp3" data-duration="15:20">Глава 2: Зов бездны (15:20)</div>
                        <div class="audio-chapter" data-audio="audio/chapter3.mp3" data-duration="18:45">Глава 3: Тени прошлого (18:45)</div>
                        <div class="audio-chapter" data-audio="audio/chapter4.mp3" data-duration="22:10">Глава 4: Последний рассвет (22:10)</div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="reviews-tab">
                <div class="title-frame">
                    <h1>Критико-самодеятельные отклики</h1>
                    <p style="color: var(--text-secondary);">⫘⫘⫘⫘⫘⫘</p>
                </div>

                <div class="reviews-container">
                    <div class="review">
                        <div class="review-header">
                            <span class="review-author">Алексей Петров</span>
                            <span class="review-date">15 января 2023</span>
                        </div>
                        <div class="review-text">
                            Невероятная атмосфера! Читал ночью при свечах и полностью погрузился в этот мрачный мир. Автор мастерски создаёт напряжение, которое не отпускает до самой последней страницы.
                        </div>
                    </div>

                    <div class="review">
                        <div class="review-header">
                            <span class="review-author">Мария Иванова</span>
                            <span class="review-date">3 марта 2023</span>
                        </div>
                        <div class="review-text">
                            Книга оставила смешанные чувства. С одной стороны, безупречный стиль и глубокая философия, с другой - слишком мрачно и безысходно. Тем не менее, читала на одном дыхании.
                        </div>
                    </div>

                    <div class="review">
                        <div class="review-header">
                            <span class="review-author">Дмитрий Смирнов</span>
                            <span class="review-date">22 апреля 2023</span>
                        </div>
                        <div class="review-text">
                            Лучшая книга года! Купил бумажную версию после прочтения электронной - хочу перечитывать с карандашом в руках. Каждая фраза здесь выверена и наполнена смыслом.
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="archive-tab">
                <div class="title-frame">
                    <h1>reАрхив</h1>
                    <p style="color: var(--text-secondary);">Ремастеры архивных бредоказов</p>
                </div>

                <div class="archive-container">
                    <div class="story-card">
                        <div class="story-header">
                            <h3 class="story-title">Последний поезд в Бобруйск</h3>
                            <div class="story-meta">
                                <span class="story-date">15 марта 2023</span>
                                <span class="story-author">Иван Петрович</span>
                            </div>
                        </div>
                        <div class="story-excerpt">
                            <p>Поезд №742 замедлял ход, приближаясь к полустанку. В окне мелькали редкие огни, далёкие и равнодушные, как звёзды над пустыней. Я знал, что этого поезда не существует в расписании, но почему-то оказался в его вагоне, среди теней, которые когда-то были людьми.</p>
                            <div class="story-full">
                                <p>Кондуктор протянул руку - его пальцы были неестественно длинными, почти доходили до моих колен. "Ваш билет," - произнёс он голосом, который звучал как скрип несмазанных колёс.</p>
                                <div class="quote">
                                    "Некоторые поезда приходят только один раз в жизни. И уходят навсегда."
                                </div>
                            </div>
                        </div>
                        <a class="read-more" onclick="toggleFullText(this)">Читать полностью →</a>
                        <div class="story-tags">
                            <span class="story-tag">Мистика</span>
                            <span class="story-tag">Железная дорога</span>
                        </div>
                    </div>

                    <div class="story-card">
                        <div class="story-header">
                            <h3 class="story-title">Кассиопея над свалкой</h3>
                            <div class="story-meta">
                                <span class="story-date">2 февраля 2023</span>
                                <span class="story-author">Анна Космическая</span>
                            </div>
                        </div>
                        <div class="story-excerpt">
                            <p>Мы сидели на крыше заброшенного завода, разглядывая звёзды сквозь смог городской свалки. Водка была дешёвой, но звёзды — настоящими. Именно тогда Васька указал пальцем на Кассиопею и сказал: "Она мигает не так".</p>
                            <div class="story-full">
                                <p>Я открыл дневник на последней странице. Бумага была влажной и пахла ржавчиной. Почерк Васьки, обычно такой размашистый и уверенный, здесь дрожал.</p>
                                <div class="quote">
                                    "Когда смотришь на звёзды, помни — они тоже смотрят на тебя."
                                </div>
                            </div>
                        </div>
                        <a class="read-more" onclick="toggleFullText(this)">Читать полностью →</a>
                        <div class="story-tags">
                            <span class="story-tag">Космос</span>
                            <span class="story-tag">Постапокалипсис</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Переключение темы
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;
        const savedTheme = localStorage.getItem('theme') || 'dark';
        
        function applyTheme(theme) {
            body.setAttribute('data-theme', theme);
            themeToggle.textContent = theme === 'light' ? '❍' : '☀︎';
            localStorage.setItem('theme', theme);
        }
        
        applyTheme(savedTheme);
        
        themeToggle.addEventListener('click', () => {
            const newTheme = body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            applyTheme(newTheme);
        });

        // Аудио-панель
        const audioToggle = document.getElementById('audioToggle');
        const audioPanel = document.getElementById('audioPanel');
        let currentAudio = null;
        
        audioToggle.addEventListener('click', () => audioPanel.classList.toggle('show'));
        
        document.querySelectorAll('.audio-option').forEach(option => {
            option.addEventListener('click', () => {
                document.querySelectorAll('.audio-option').forEach(opt => opt.classList.remove('active'));
                option.classList.add('active');
                const sound = option.getAttribute('data-sound');
                
                if (currentAudio) {
                    currentAudio.pause();
                    currentAudio = null;
                }
                
                if (sound !== 'none') {
                    currentAudio = new Audio(sound);
                    currentAudio.loop = true;
                    currentAudio.play().catch(e => console.log('Автовоспроизведение заблокировано:', e));
                }
                
                setTimeout(() => audioPanel.classList.remove('show'), 2000);
            });
        });

        document.addEventListener('click', (e) => {
            if (!audioPanel.contains(e.target) && e.target !== audioToggle) {
                audioPanel.classList.remove('show');
            }
        });

        // Панель выбора шрифтов
        const fontToggle = document.getElementById('fontToggle');
        const fontPanel = document.getElementById('fontPanel');
        const savedFont = localStorage.getItem('font') || "'Noto Serif', serif";
        
        function applyFont(font) {
            document.documentElement.style.setProperty('--current-font', font);
            document.querySelectorAll('.font-option').forEach(opt => opt.classList.remove('active'));
            document.querySelector(`.font-option[data-font="${font}"]`).classList.add('active');
            localStorage.setItem('font', font);
        }
        
        applyFont(savedFont);
        
        fontToggle.addEventListener('click', () => fontPanel.classList.toggle('show'));
        
        document.querySelectorAll('.font-option').forEach(option => {
            option.addEventListener('click', () => {
                const font = option.getAttribute('data-font');
                applyFont(font);
                setTimeout(() => fontPanel.classList.remove('show'), 1000);
            });
        });

        document.addEventListener('click', (e) => {
            if (!fontPanel.contains(e.target) && e.target !== fontToggle) {
                fontPanel.classList.remove('show');
            }
        });

        // Переключение вкладок
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab, .tab-content').forEach(el => el.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(`${tab.getAttribute('data-tab')}-tab`).classList.add('active');
            });
        });

        // Lazy loading изображений
        const lazyLoadImages = () => {
            const images = document.querySelectorAll('img[data-src]');
            const observer = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        img.src = img.getAttribute('data-src');
                        img.onload = () => {
                            img.classList.add('loaded');
                            img.removeAttribute('data-src');
                        };
                        observer.unobserve(img);
                    }
                });
            }, {
                rootMargin: '100px',
                threshold: 0.1
            });

            images.forEach(img => observer.observe(img));
        };

        // Аудиоплеер для аудиокниг
        const audioPlayer = {
            audio: new Audio(),
            currentChapter: 0,
            isPlaying: false,
            chapters: document.querySelectorAll('.audio-chapter'),
            
            init() {
                this.audio.addEventListener('timeupdate', this.updateProgress.bind(this));
                this.audio.addEventListener('ended', this.nextChapter.bind(this));
                this.audio.addEventListener('loadedmetadata', this.updateDuration.bind(this));
                
                document.getElementById('playPause').addEventListener('click', this.togglePlay.bind(this));
                document.getElementById('prevChapter').addEventListener('click', this.prevChapter.bind(this));
                document.getElementById('nextChapter').addEventListener('click', this.nextChapter.bind(this));
                document.getElementById('audioProgress').addEventListener('click', this.seek.bind(this));
                
                this.chapters.forEach((chapter, index) => {
                    chapter.addEventListener('click', () => this.loadChapter(index));
                });
                
                this.loadChapter(0);
            },
            
            loadChapter(index) {
                if (index >= 0 && index < this.chapters.length) {
                    this.currentChapter = index;
                    const chapter = this.chapters[index];
                    const audioSrc = chapter.getAttribute('data-audio');
                    
                    this.chapters.forEach(c => c.classList.remove('active'));
                    chapter.classList.add('active');
                    
                    document.getElementById('currentChapterTitle').textContent = chapter.textContent.split('(')[0].trim();
                    document.getElementById('duration').textContent = chapter.getAttribute('data-duration');
                    
                    this.audio.src = audioSrc;
                    if (this.isPlaying) {
                        this.audio.play().catch(e => console.log('Автовоспроизведение заблокировано:', e));
                    }
                }
            },
            
            togglePlay() {
                this.isPlaying = !this.isPlaying;
                const btn = document.getElementById('playPause');
                btn.textContent = this.isPlaying ? '(‿¤‿)' : '(‿ˠ‿)';
                
                if (this.isPlaying) {
                    this.audio.play().catch(e => console.log('Автовоспроизведение заблокировано:', e));
                } else {
                    this.audio.pause();
                }
            },
            
            prevChapter() {
                this.loadChapter(this.currentChapter - 1);
            },
            
            nextChapter() {
                this.loadChapter(this.currentChapter + 1);
            },
            
            updateProgress() {
                const progress = (this.audio.currentTime / this.audio.duration) * 100;
                document.getElementById('progressFilled').style.width = `${progress}%`;
                document.getElementById('currentTime').textContent = this.formatTime(this.audio.currentTime);
            },
            
            updateDuration() {
                document.getElementById('duration').textContent = this.formatTime(this.audio.duration);
            },
            
            seek(e) {
                const progressBar = document.getElementById('audioProgress');
                const pos = (e.pageX - progressBar.getBoundingClientRect().left) / progressBar.offsetWidth;
                this.audio.currentTime = pos * this.audio.duration;
            },
            
            formatTime(seconds) {
                if (isNaN(seconds)) return '0:00';
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
            }
        };

        // Раскрытие текста
        function toggleFullText(link) {
            const fullText = link.closest('.story-card').querySelector('.story-full');
            const isExpanded = fullText.classList.contains('show');
            
            fullText.classList.toggle('show');
            link.textContent = isExpanded ? 'Читать полностью →' : 'Свернуть ↑';
            
            setTimeout(() => {
                (isExpanded ? link : fullText).scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 300);
        }

        // Анимированный смайл (одноразовый)
        function initFloatingSmiley() {
            const smiley = document.getElementById('floatingSmiley');
            let wasShown = false;
            
            window.addEventListener('scroll', () => {
                if (wasShown) return;
                
                const scrollPosition = window.scrollY;
                const windowHeight = window.innerHeight;
                const documentHeight = document.documentElement.scrollHeight;
                const middlePosition = documentHeight / 2 - windowHeight / 2;
                
                if (scrollPosition >= middlePosition - 200) {
                    wasShown = true;
                    smiley.style.opacity = '1';
                    smiley.style.left = '-100px';
                    smiley.style.top = `${windowHeight / 2}px`;
                    smiley.style.animation = 'floatAndRotate 8s linear forwards';
                    
                    setTimeout(() => {
                        smiley.style.opacity = '0';
                    }, 8000);
                }
            });
        }

        // Параллакс-эффект для изображений глав с увеличением
        function initChapterParallax() {
            const chapterImages = document.querySelectorAll('.chapter-image.loaded');
            const zoomOverlay = document.getElementById('imageZoomOverlay');
            const zoomedImage = document.getElementById('zoomedImage');
            const closeZoom = document.getElementById('closeZoom');
            
            // Генерируем случайные параметры параллакса для каждого изображения
            chapterImages.forEach(img => {
                // Случайное направление (-1 или 1)
                img.dataset.parallaxDirection = Math.random() > 0.5 ? 1 : -1;
                // Случайная интенсивность (от 0.5 до 1.5)
                img.dataset.parallaxIntensity = (Math.random() * 1 + 0.5).toFixed(2);
            });
            
            window.addEventListener('scroll', () => {
                chapterImages.forEach(img => {
                    const rect = img.getBoundingClientRect();
                    const isVisible = rect.top < window.innerHeight && rect.bottom > 0;
                    
                    if (isVisible) {
                        const imgCenter = rect.top + rect.height / 2;
                        const screenCenter = window.innerHeight / 2;
                        const distanceFromCenter = imgCenter - screenCenter;
                        const maxDistance = window.innerHeight / 2 + rect.height / 2;
                        const ratio = Math.min(Math.max(distanceFromCenter / maxDistance, -1), 1);
                        
                        // Параллакс-эффект с учетом случайных параметров
                        const rotateY = ratio * 5 * img.dataset.parallaxDirection * img.dataset.parallaxIntensity;
                        const translateY = ratio * 30 * img.dataset.parallaxIntensity;
                        const scale = 1 + Math.abs(ratio) * 0.05 * img.dataset.parallaxIntensity;
                        
                        img.style.transform = `perspective(1000px) rotateY(${rotateY}deg) translateY(${translateY}px) scale(${scale})`;
                    }
                });
            });
            
            // Обработка клика для увеличения изображения
            chapterImages.forEach(img => {
                img.addEventListener('click', () => {
                    zoomedImage.src = img.src;
                    zoomOverlay.classList.add('active');
                    setTimeout(() => {
                        zoomedImage.classList.add('zoom-active');
                    }, 10);
                });
            });
            
            // Закрытие увеличенного изображения
            closeZoom.addEventListener('click', () => {
                zoomedImage.classList.remove('zoom-active');
                setTimeout(() => {
                    zoomOverlay.classList.remove('active');
                }, 300);
            });
            
            // Закрытие по клику на оверлей
            zoomOverlay.addEventListener('click', (e) => {
                if (e.target === zoomOverlay) {
                    zoomedImage.classList.remove('zoom-active');
                    setTimeout(() => {
                        zoomOverlay.classList.remove('active');
                    }, 300);
                }
            });
        }

        // Галерея изображений для глав
        function initChapterGalleries() {
            document.querySelectorAll('.chapter-image-container').forEach(container => {
                const slider = container.querySelector('.chapter-image-slider');
                const images = container.querySelectorAll('.chapter-image');
                const prevBtn = container.querySelector('.image-nav.prev');
                const nextBtn = container.querySelector('.image-nav.next');
                const counter = container.querySelector('.image-counter');
                
                let currentIndex = 0;
                const totalImages = images.length;
                
                function updateCounter() {
                    counter.textContent = `${currentIndex + 1}/${totalImages}`;
                }
                
                function showImage(index) {
                    currentIndex = index;
                    slider.style.transform = `translateX(-${currentIndex * 100}%)`;
                    updateCounter();
                    
                    images.forEach(img => {
                        if (img.classList.contains('loaded')) {
                            initChapterParallax();
                        }
                    });
                }
                
                prevBtn.addEventListener('click', () => {
                    currentIndex = (currentIndex - 1 + totalImages) % totalImages;
                    showImage(currentIndex);
                });
                
                nextBtn.addEventListener('click', () => {
                    currentIndex = (currentIndex + 1) % totalImages;
                    showImage(currentIndex);
                });
                
                let touchStartX = 0;
                let touchEndX = 0;
                
                container.addEventListener('touchstart', (e) => {
                    touchStartX = e.changedTouches[0].screenX;
                }, false);
                
                container.addEventListener('touchend', (e) => {
                    touchEndX = e.changedTouches[0].screenX;
                    handleSwipe();
                }, false);
                
                function handleSwipe() {
                    if (touchEndX < touchStartX - 50) {
                        currentIndex = (currentIndex + 1) % totalImages;
                        showImage(currentIndex);
                    } else if (touchEndX > touchStartX + 50) {
                        currentIndex = (currentIndex - 1 + totalImages) % totalImages;
                        showImage(currentIndex);
                    }
                }
                
                container.addEventListener('mouseenter', () => {
                    prevBtn.style.opacity = '0.7';
                    nextBtn.style.opacity = '0.7';
                });
                
                container.addEventListener('mouseleave', () => {
                    prevBtn.style.opacity = '0.7';
                    nextBtn.style.opacity = '0.7';
                });
                
                updateCounter();
            });
        }

        // Инициализация
        document.addEventListener('DOMContentLoaded', () => {
            lazyLoadImages();
            audioPlayer.init();
            initFloatingSmiley();
            initChapterGalleries();
            
            const checkImagesLoaded = setInterval(() => {
                const images = document.querySelectorAll('.chapter-image');
                const loadedImages = document.querySelectorAll('.chapter-image.loaded');
                
                if (images.length > 0 && images.length === loadedImages.length) {
                    clearInterval(checkImagesLoaded);
                    initChapterParallax();
                }
            }, 500);
        });
    </script>
</body>
</html>
